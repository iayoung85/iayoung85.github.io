<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transaction Viewer - Bank Transactions</title>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <link rel="icon" type="image/png" href="IAY favicon.png">
  <link rel="stylesheet" href="transactions.css">
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-link">← Back to Dashboard</a>
    
    <h1>Transaction Viewer</h1>
    
    <!-- Configuration Panel -->
    <div class="config-panel">
      <div class="config-header" onclick="toggleConfig()">
        <span>Configuration</span>
        <span id="toggle-icon">▼</span>
      </div>
      <div class="config-content" id="config-content">
        
        <!-- Bank & Account Selection -->
        <div class="config-section">
          <div style="display: flex; justify-content: flex-start; align-items: center; margin-bottom: 10px;">
            <h3 style="margin: 0;">Select Accounts</h3>
            <button onclick="selectAllAccounts()" class="secondary" style="padding: 4px 8px; font-size: 12px; margin-right: 8px; margin-left: 8px;">Select All</button>
            <button onclick="deselectAllAccounts()" class="secondary" style="padding: 4px 8px; font-size: 12px; margin-right: 8px;">Deselect All</button>
            <button onclick="refreshAccounts()" class="secondary" style="padding: 4px 8px; font-size: 12px;">Refresh List</button>
          </div>
          <p style="margin: 0 0 10px 0; font-size: 14px; color: #666;">Only checking, savings, and credit card accounts are shown. Investment accounts are not currently supported.</p>
          <div id="account-selector"></div>
        </div>
        
        <!-- Date Range -->
        <div class="config-section">
          <h3>Date Range (up to 90 days of transaction data is available)</h3>
          <div style="display: flex; align-items: center; gap: 10px;">
            <input type="date" id="start-date">
            <input type="date" id="end-date">
            <button onclick="setMonthToDate()" class="secondary" style="padding: 4px 8px; font-size: 12px;">Month to Date</button>
            <button onclick="setLastMonth()" class="secondary" style="padding: 4px 8px; font-size: 12px;">Last Month</button>
          </div>
        </div>
        
        <!-- Timezone -->
        <div class="config-section">
          <h3>Timezone</h3>
          <select id="timezone">
            <option value="America/New_York">Eastern Time (ET)</option>
            <option value="America/Chicago" selected>Central Time (CT)</option>
            <option value="America/Denver">Mountain Time (MT)</option>
            <option value="America/Los_Angeles">Pacific Time (PT)</option>
            <option value="UTC">UTC</option>
          </select>
        </div>

        <!-- Optional Fields -->
        <div class="config-section">
          <h3>Optional Fields</h3>
          <div class="optional-fields-grid">
            <label><input type="checkbox" class="field-checkbox" value="merchant_name"> Merchant Name</label>
            <label><input type="checkbox" class="field-checkbox" value="category"> Category</label>
            <label><input type="checkbox" class="field-checkbox" value="payment_channel"> Payment Channel</label>
            <label><input type="checkbox" class="field-checkbox" value="pending"> Pending Status</label>
            <label><input type="checkbox" class="field-checkbox" value="check_number"> Check Number</label>
            <label><input type="checkbox" class="field-checkbox" value="original_description"> Original Description</label>
            <label><input type="checkbox" class="field-checkbox" value="authorized_date"> Authorized Date</label>
            <label><input type="checkbox" class="field-checkbox" value="authorized_datetime"> Authorized Time</label>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="config-section">
          <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
            <button onclick="syncTransactions()">Sync Transactions</button>
            <button onclick="loadTransactions()" id="load-btn" disabled>Load Data</button>
            <button onclick="saveSettings()" class="secondary">Save Settings</button>
            
            <!-- Export Buttons (initially hidden until data loaded) -->
            <div id="export-buttons" class="export-buttons hidden">
              <button onclick="exportJSON()" class="secondary">Export JSON</button>
              <button onclick="copyCSV()" class="secondary">Copy CSV</button>
              <button onclick="downloadCSV()" class="secondary">Download CSV</button>
            </div>
          </div>
          <div id="status-message"></div>
        </div>
        
      </div>
    </div>
    
    <!-- Transaction Table -->
    <div id="table-container">
      <div class="empty-state">
        Configure your settings above and click "Sync Transactions" to get started.
      </div>
    </div>
    
  </div>

  <script src="config.js"></script>
  <script src="transactions.js"></script>
</body>
</html>
